# Changelog

## v1.4.0 · 2025-10-18

### 🎨 UI/UX

- 重塑桌面端首页，加入醒目的欢迎横幅、状态概览卡片以及重新排布的功能标签页，整体视觉与 Pasteme 风格保持一致。
- 调整全局主题的间距、渐变与毛玻璃效果，让窗口切换和滚动体验更顺滑。

### ⚙️ 桌面集成

- 为全新首页恢复无框窗口拖拽区域，确保在 Windows 等平台依旧可以拖动窗口。
- 保持 tauri 配置、版本号与桌面端 (Rust/JS) 元数据同步至 v1.4.0，方便后续发布与测试。

### 🧹 代码健康

- 清理与整合首页布局相关样式，避免重复定义并提升可维护性。

## v1.3.7 · 2025-10-17

### 🔧 关键修复

- **彻底解决白屏问题**: 修复"AI工具"和"设置/关于"页面的白屏和渲染失败问题
  - 修复 `AiQuickActions.vue` 组件中的 HTML 结构错误（未正确关闭的 `<div>` 标签）
  - 修复 `Settings.vue` 模板缩进不一致问题
  - 为两个页面添加 settings store hydration 等待逻辑，确保配置加载完成后再渲染
  - 增加超时保护机制（3秒），避免无限等待
  - 添加完整的加载中骨架屏，提升用户体验

### ✨ 错误处理增强

- **页面级错误边界完善**:
  - `AiTools.vue` 和 `Settings.vue` 增加 `onErrorCaptured` 钩子
  - 所有异步操作使用 try-catch 包装
  - 显示用户友好的错误信息和重试按钮
  - 错误不会导致整个应用崩溃

- **初始化流程优化**:
  - 等待 settings store 完全 hydrate 后再显示页面内容
  - 加载中显示骨架屏而非白屏
  - 超时保护确保即使加载失败也能显示基本界面

### 🎨 UI/UX 改进

- **加载状态优化**:
  - AI工具页面添加加载中骨架屏
  - 设置页面加载状态更加明确
  - 平滑的加载到显示内容的过渡

### 🧪 质量保证

- ✅ TypeScript 编译通过（`pnpm exec vue-tsc --noEmit`）
- ✅ 无 linter 错误
- ✅ 所有页面路由正常工作
- ✅ 页面切换流畅无白屏

---

## v1.3.6 fixed · 2025-10-17

### 🔧 关键修复

- **尝试修复白屏卡死问题**: 修复了导致"AI工具"、"设置关于"页面白屏的根本原因
  - 修复 `src/main.ts` 中 `unhandledrejection` 事件监听器的语法错误
  - 添加 Vue 全局错误处理器 `app.config.errorHandler` 防止未捕获错误导致应用崩溃
  - 添加路由错误守卫和导航错误处理
  - 为所有页面组件添加 `onErrorCaptured` 错误边界,确保组件错误不会传播
  - 所有异步操作都增加了 try-catch 包装和错误恢复机制

### 📐 架构优化

- **简化导航结构**: 移除独立的"收藏/置顶"页面,功能整合到"历史记录"页面
  - 删除 `src/pages/Favorites.vue` 页面
  - 历史记录页面的筛选器已包含"置顶"和"收藏"选项
  - 侧边栏菜单精简为 4 个核心功能:剪贴板、历史记录、AI工具、设置
  - 避免页面过多导致的混乱和潜在的路由问题

### ✨ AI 功能优化

- **历史记录右键 AI 操作体验提升**:
  - 未配置 API Key 时显示友好的确认对话框
  - 提供"前往设置"和"取消"按钮,引导用户配置
  - 不再直接白屏,而是给予明确的操作指引

- **剪贴板页面增加 AI 快捷操作**:
  - 新增 AI 快捷操作卡片,支持对当前剪贴板内容直接进行翻译/摘要/润色等操作
  - 调整布局为三列网格:当前剪贴板 | AI 快捷操作 | 最近历史
  - 响应式布局优化,窄屏自动切换为单列堆叠

### 🎨 UI/UX 改进

- **历史记录筛选选项卡美化**:
  - 采用现代分段控制器样式替代旧的单选按钮组
  - 使用圆角、渐变背景、平滑过渡动画
  - 活动标签带有阴影和上浮效果,视觉反馈更明确
  - 优化间距和字体权重,整体更精致

- **错误提示优化**:
  - 所有页面增加错误提示横幅,显示具体错误信息
  - 提供"重试"按钮快速恢复,无需刷新页面
  - 错误可关闭,不会阻碍正常使用

- **加载状态优化**:
  - 为各个页面添加加载状态指示
  - 骨架屏和加载动画更流畅

### 📋 技术细节

- 全局错误处理:阻止默认错误行为,记录详细日志,防止页面崩溃
- 组件错误边界:使用 `onErrorCaptured` 捕获子组件错误并阻止传播
- 错误恢复机制:所有关键操作都有降级方案和重试入口
- 路由守卫:防止导航过程中的异常导致白屏
- 代码质量:清理未使用的变量,优化导入语句

### 🐞 已知问题修复

- ✅ 点击"AI工具"不再白屏
- ✅ 点击"设置关于"不再白屏
- ✅ 未配置 API Key 时右键 AI 功能不再白屏,显示友好提示
- ✅ 页面组件挂载失败时显示错误而非白屏
- ✅ 移除了导致白屏的"收藏/置顶"独立页面,功能已整合到历史记录

## v1.3.6 · 2025-10-17

### 🐞 关键修复

- **修复白屏崩溃问题**: 点击"收藏"或"置顶"按钮后不再导致页面白屏卡死
  - 添加了完整的前后端日志链路追踪,便于问题定位
  - 实现了1秒防抖保护,防止连续快速点击导致状态异常
  - 优化了 `update_clip_flags` 命令的错误处理和状态同步逻辑
  - 添加了按钮禁用状态视觉反馈,提升用户体验

### ⚡ 性能优化

- **数据库查询优化**: 新增多个复合索引,提升历史记录查询速度
  - 添加 `idx_clips_updated_at` 索引优化时间排序
  - 优化 `idx_clips_favorite` 复合索引结构
  - 新增 `idx_clips_composite` 复合索引覆盖常用查询场景
- **前端渲染优化**:
  - 调整虚拟滚动 item-size (178 → 190) 提升渲染准确性
  - 优化图片懒加载配置,添加 `fetchpriority="low"` 属性
  - 改进组件过渡动画性能,减少重绘和重排

### 🎨 UI/UX 改进

- **交互动效优化**:
  - 按钮悬停放大至 1.1 倍,点击缩小至 0.95 倍,提供清晰的操作反馈
  - 历史卡片悬停上移 2px 并显示阴影,增强层次感
  - 操作按钮淡入淡出过渡时长优化为 150ms,更加流畅
  - 添加 `will-change: transform` 优化动画性能
- **状态标识改进**:
  - 置顶记录边框显示蓝色高亮
  - 收藏记录边框显示金色高亮
  - 边框颜色过渡动画更平滑(0.2s ease-out)

### 🛠️ 开发者工具

- **日志系统增强**:
  - 前端添加 `[HistoryItem]` 和 `[History Store]` 命名空间日志
  - 后端添加详细的 SQL 执行和影响行数日志
  - 便于快速定位和调试问题
- **测试指南**: 新增 `TESTING_GUIDE.md` 文档
  - 包含完整的测试步骤和验收标准
  - 提供日志检查点和常见问题排查指南
  - 覆盖白屏修复、性能、UI/UX 等所有改进点

### 📋 技术细节

- 防止重复处理: 使用 `isProcessing` 状态标志防止并发操作
- 错误处理增强: 在前后端所有关键路径添加 try-catch 和详细错误信息
- 数据库日志: 记录影响行数,当为0时输出警告,便于发现潜在问题

## v1.3.5 · 2025-10-17

### 🛠 修复 (Hotfix)

- 修复 Tauri 2.x 中 `async_runtime::time` 模块不存在的问题，改用 `tokio::time::sleep` 替代。
- 添加 `tauri::Emitter` trait 导入，修复 `emit` 方法找不到的编译错误。
- 修复 `image` crate 0.25.x 中 `ColorType` 到 `ExtendedColorType` 的类型转换问题。
- 在 `Cargo.toml` 中添加 `tokio` 依赖以支持异步睡眠功能。

## v1.3.4 · 2025-10-17

### 🛠 修复

- 兼容 Tauri 2 的异步运行时时间 API，恢复剪贴板监听退避与暂停逻辑的异步睡眠实现。
- 使用 `AppHandle::emit` 适配新版事件广播接口，确保前端及时收到 `clipboard://captured` 事件。
- 修复 PNG 编码器写入方法与文件路径检测闭包签名，以恢复 Rust 模块在 Windows 上的编译通过。
- 同步前后端与文档版本号至 v1.3.4。

## v1.3.3 · 2025-10-17

### 🛠 修复

- 补充 `clipboard_watcher` 模块声明，恢复 `pnpm tauri dev` 在 Windows 上的编译通过。
- 清理 Rust 警告（移除未使用的变量与多余的 `mut`），保持构建日志干净。
- 统一 `Cargo.toml`、`tauri.conf.json`、`package.json` 与前端回退版本展示至 1.3.3。
- 文档更新 Windows 快速启动指引，验证 `pnpm i && pnpm tauri dev` 一次完成流程。

## v1.3.2 · 2025-10-17

### 🛠 修复

- 固定 `tracing-subscriber` 至 0.3.18 并移除已废弃的 `reload` 特性，恢复 `pnpm tauri dev` 编译流程。
- 前端与文档版本号同步至 v1.3.2，保持 UI 显示与发布指引一致。

## v1.3.1 · 2025-10-17

### ⚙️ 性能与稳定性

- SQLite 新增 `kind`/`pinned`/`hash` 复合索引与分页查询，后台冷启动异步预热并可一键 VACUUM。
- 剪贴板监听线程改为异步解耦 + 退避重试，支持 250~400 ms 去抖与黑名单过滤，连续复制 10+ 项不丢失。
- 历史列表保持虚拟滚动并引入分页加载按钮，图片缩略图懒加载、Diff 渲染更平滑。

### ✨ 功能补齐

- 文本 / 图像 / 文件 三种历史项均支持复制、置顶、删除、AI 右键操作，并可按类型筛选或搜索前缀。
- 设置页新增去重开关、容量上限、忽略来源、日志等级等偏好项，可即时同步至后端运行时。
- 托盘、全局快捷键、单实例守护继续沿用，关于页补充运行时版本号与反馈链接。

### 📄 文档

- README 更新至 v1.3.1，补充主界面 / 历史 / AI / 设置 / 关于最新截图与快捷键说明。
- 新增 PasteMe 对标清单链接，帮助验证 1.3.1 覆盖范围。

## v1.3.0 · 2025-10-16

### ✨ 剪贴板增强

- 新增后台轮询监听器，可在 250~400 ms 节流间隔内持续捕获文本、图像与文件三种剪贴板内容，并带时间戳落盘。
- 引入内容哈希去重与 SQLite `upsert` 逻辑，避免重复记录并兼容历史库迁移。
- 历史页增加类型筛选、搜索框、虚拟滚动与图片懒加载，连续复制 5+ 条内容依旧顺畅显示。

### 🤖 AI 与交互

- 历史项新增右键菜单：翻译 / 摘要 / 润色，可复制结果或保存回历史，未配置 API Key 时引导至设置。
- 侧栏扩展为「剪贴板 / 历史记录 / 收藏 / AI 工具 / 设置」，窗口拖拽与托盘行为保持稳定。

### 🎨 体验与文档

- 设置页改为自适应单列布局，减少留白并在窄屏保持可用。
- 应用左下角版本号自动同步 `@tauri-apps/api/app.getVersion()`（v1.3.0）。
- README 与发布指引更新至 v1.3.0，补充全新功能亮点。

## v1.2.1 (2025-10-16)

- Fix: removed deprecated set_transparent API (Tauri v2)
- Fix: clean up build warnings and ensure compatibility
- Improve: verified pnpm tauri dev/build runs successfully

## v1.2.0 · 2025-10-16

### 🛠 可用性修复

- 解决了设置 Store 在应用挂载前同步 `await` Tauri Store 调用导致的白屏问题，改为启动后异步拉取并在 3 秒超时后使用默认值渲染界面。
- 重写主界面框架，引入窗口标题栏拖拽区域、骨架屏与错误提示，确保首次打开 2 秒内可见内容且窗口可拖动。
- 统一跨进程调用的异常上报与通知桥接，防止初始化阶段因未捕获错误静默失败。
- Rust 端在 Debug 环境禁用透明窗口并自动打开 DevTools，便于排查页面渲染问题。

## v1.0.1 · 2025-10-16

### 🐞 修复

- 前端改用 Tauri v2 插件包（Dialog / FS 等）并更新窗口 API，解决依赖缺失与运行时报错。
- Tailwind 引入 `tailwindcss-animated` 官方插件配置，恢复动画类名支持。
- 修复 Rust 端 Store 读写、托盘菜单事件与数据库操作以适配 Tauri v2。

### ⚙️ 调整

- 升级版本号至 1.0.1，更新构建配置与发行文档。

## v1.0.0 · 2025-10-16

### ✨ 全面升级

- 项目更名为 **VibeClip Pro**，全新浅/深色主题与 220 px 渐变侧栏。
- 历史记录改为 SQLite 持久化，支持文本、图像（Base64）、文件路径的搜索、置顶、收藏与 JSON 导入导出。
- 新增 AI 快捷操作卡片（翻译 / 摘要 / 润色 / JSON 化 / 自定义 Prompt），兼容 OpenAI 接口并可一键写回剪贴板。

### 🧰 系统集成

- 默认全局快捷键 `Ctrl+Shift+V`，托盘菜单支持显示/隐藏、暂停监听、离线模式切换、退出。
- 设置页提供 API 配置、主题与行高调整、开机自启（插件封装）及缓存清理。
- Panel 浮窗重写，提供最近条目快速粘贴。

### ⚙️ 工程调整

- 构建体系切换至 `pnpm`，`tauri.conf.json`、脚本与文档同步更新。
- 前端使用 Vue 3 + Pinia + Naive UI 按需加载；Iconify 自动引入。
- Rust 端新增 `db.rs` / `ai_client.rs` / `clipboard.rs`，集中处理 SQLite 操作、AI 请求与状态管理。
